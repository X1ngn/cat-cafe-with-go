# 前端功能说明

## 🎨 界面特性

### 三栏布局
- **左侧栏**：会话列表，显示所有对话会话
- **中间栏**：对话区域，显示消息和输入框
- **右侧栏**：状态栏，显示猫猫状态

### 头像系统
- **用户头像**：显示用户的专属头像 (`images/owner.png`)
- **猫猫头像**：每只猫猫都有独特的头像
  - 花花：`images/sanhua.png`
  - 薇薇：`images/weiwei.png`
  - 小乔：`images/xiaoqiao.png`
- **头像显示位置**：
  - 消息气泡旁边
  - @ 提及菜单中
  - 状态栏中

## 💬 消息功能

### 消息类型
1. **用户消息** (`type: "user"`)
   - 显示在右侧
   - 浅色背景
   - 显示用户头像

2. **猫猫消息** (`type: "cat"`)
   - 显示在左侧
   - 带有猫猫头像
   - 显示猫猫名字

3. **系统消息** (`type: "system"`)
   - 居中显示
   - 灰色文字
   - 用于提示信息

### @ 提及功能

#### 触发方式
输入 `@` 字符会自动弹出猫猫选择菜单

#### 菜单特性
- **显示内容**：
  - 猫猫头像
  - 猫猫名字
  - 在线状态（在线/离线）
- **搜索过滤**：输入猫猫名字可以过滤列表
- **智能关闭**：
  - 光标移开 @ 字符时自动关闭
  - 输入空格时关闭
  - 按 ESC 键关闭
  - 支持方向键移动光标检测

#### 使用示例
```
输入: @
结果: 弹出猫猫选择菜单

输入: @花
结果: 只显示"花花"

选择猫猫后: @花花
继续输入任务内容
```

## 🔄 实时消息推送

### 智能轮询机制

前端使用智能轮询自动获取新消息，无需手动刷新页面。

#### 轮询策略
1. **快速轮询**（1 秒间隔）
   - 触发条件：用户发送消息后
   - 目的：快速获取猫猫回复
   - 持续时间：直到收到猫猫回复

2. **慢速轮询**（3 秒间隔）
   - 触发条件：收到猫猫回复后
   - 目的：保持消息同步，节省资源
   - 持续时间：直到下次发送消息

#### 技术实现
```typescript
// 状态管理
waitingForReply: boolean  // 是否等待回复

// 发送消息时
setWaitingForReply(true)  // 开启快速轮询

// 收到猫猫回复时
setWaitingForReply(false) // 切换到慢速轮询

// 轮询间隔
const interval = waitingForReply ? 1000 : 3000
```

#### 用户体验
- ✅ 发送消息后立即看到自己的消息
- ✅ 1-2 秒内看到猫猫的回复
- ✅ 猫猫互相调用时，所有回复都能正确显示
- ✅ 无需手动刷新页面
- ✅ 自动滚动到最新消息

## 🐱 猫猫互相调用

### 功能说明
当一只猫猫在回复中 @ 另一只猫猫时，被调用的猫猫会自动处理任务并回复。

### 显示效果
```
用户: @花花 请你调用@薇薇帮忙
  ↓
花花: 好的，我来调用薇薇
      @薇薇 请帮忙审查代码
  ↓
薇薇: 收到！我来审查
      [审查结果...]
```

### 技术细节
- **SessionID 传递**：猫猫互相调用时传递当前会话 ID
- **AgentName 设置**：创建任务时设置被调用猫猫的名字
- **头像显示**：根据 AgentName 正确显示猫猫头像
- **消息类型**：所有猫猫回复都是 `type: "cat"`

## 🎯 交互优化

### 输入框
- **占位符提示**：`跟猫猫们说点什么... (@呼叫猫猫)`
- **发送按钮**：猫爪图标 🐾
- **快捷键**：Enter 键发送，Shift+Enter 换行
- **自动清空**：发送后自动清空输入框

### 消息列表
- **自动滚动**：新消息到达时自动滚动到底部
- **平滑滚动**：使用 `smooth` 滚动效果
- **消息间距**：合理的间距提升可读性

### 会话管理
- **创建会话**：点击"新建会话"按钮
- **切换会话**：点击左侧会话列表
- **删除会话**：会话列表中的删除按钮
- **会话信息**：显示最后更新时间和消息数量

## 🎨 视觉设计

### 颜色方案
- **花花**：`#ff9966` (橙色)
- **薇薇**：`#d9bf99` (米色)
- **小乔**：`#cccccc` (灰色)
- **主色调**：`#ff9966` (primary)

### 头像样式
- **形状**：圆角矩形 (`rounded-2xl`)
- **尺寸**：
  - 小号 (`sm`)：用于菜单和状态栏
  - 中号 (`md`)：用于消息气泡
- **显示方式**：
  - 有图片时显示图片
  - 无图片时显示纯色背景

### 响应式设计
- 适配不同屏幕尺寸
- 移动端友好的触摸交互
- 合理的间距和字体大小

## 🔧 技术栈

### 前端框架
- **React 18**：UI 框架
- **TypeScript**：类型安全
- **Vite**：构建工具
- **Tailwind CSS**：样式框架

### 状态管理
- **Zustand**：轻量级状态管理
- 全局状态：会话、消息、猫猫列表
- 本地状态：输入框、菜单显示

### API 通信
- **Axios**：HTTP 客户端
- RESTful API 调用
- 自动错误处理

## 📱 启动前端

### 开发模式
```bash
cd frontend
npm install
npm run dev
```

访问：http://localhost:3001/

### 生产构建
```bash
cd frontend
npm run build
```

构建产物在 `frontend/dist/` 目录

## 🐛 故障排查

### 消息不自动更新
- 检查后端 API 服务是否运行
- 检查浏览器控制台是否有错误
- 确认轮询是否正常工作

### 头像不显示
- 检查 `images/` 目录是否存在
- 确认图片文件路径正确
- 检查后端静态文件服务是否启动

### @ 菜单不弹出
- 确认输入了 `@` 字符
- 检查猫猫列表是否加载成功
- 查看浏览器控制台错误信息

## 🎉 最佳实践

1. **发送消息**：使用 @ 提及猫猫，明确指定任务
2. **等待回复**：发送后稍等片刻，消息会自动显示
3. **多猫协作**：可以同时 @ 多只猫猫
4. **查看历史**：切换会话查看之前的对话
5. **保持连接**：确保后端服务持续运行
