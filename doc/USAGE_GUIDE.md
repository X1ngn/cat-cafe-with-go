# çŒ«çŒ«å’–å•¡å±‹ä½¿ç”¨æŒ‡å—

## ğŸ¯ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
# å®‰è£… Redis
brew install redis

# ä¸‹è½½ Go ä¾èµ–
go mod download
```

### 2. ç¼–è¯‘é¡¹ç›®

```bash
make build
```

### 3. å¯åŠ¨ Redis

```bash
redis-server --daemonize yes
```

### 4. å¯åŠ¨ Agent Workers

åœ¨ä¸åŒç»ˆç«¯å¯åŠ¨å„ä¸ª Agent:

```bash
# ç»ˆç«¯ 1
./bin/cat-cafe --mode agent --agent èŠ±èŠ±

# ç»ˆç«¯ 2
./bin/cat-cafe --mode agent --agent è–‡è–‡

# ç»ˆç«¯ 3
./bin/cat-cafe --mode agent --agent å°ä¹”
```

### 5. ä½¿ç”¨äº¤äº’å¼ç•Œé¢ï¼ˆæ¨èï¼‰

```bash
./bin/cat-cafe --mode ui
```

åœ¨äº¤äº’ç•Œé¢ä¸­:

```bash
# å‘é€ä»»åŠ¡
> @èŠ±èŠ± å®ç°ä¸€ä¸ª HTTP æœåŠ¡å™¨
âœ“ ä»»åŠ¡å·²å‘é€ç»™ èŠ±èŠ±
  ä»»åŠ¡ID: xxx

> @è–‡è–‡ å®¡æŸ¥ä»£ç å®‰å…¨æ€§
âœ“ ä»»åŠ¡å·²å‘é€ç»™ è–‡è–‡

> @å°ä¹” è®¾è®¡ç™»å½•é¡µé¢
âœ“ ä»»åŠ¡å·²å‘é€ç»™ å°ä¹”

# æŸ¥çœ‹å¯ç”¨ Agent
> /list

# æŸ¥çœ‹å¸®åŠ©
> /help

# é€€å‡º
> /exit
```

---

## ğŸ“‹ ä½¿ç”¨æ–¹å¼

### æ–¹å¼ä¸€ï¼šäº¤äº’å¼ UIï¼ˆæ¨èï¼‰

æœ€ç®€å•ç›´è§‚çš„ä½¿ç”¨æ–¹å¼ï¼Œæ”¯æŒå®æ—¶äº¤äº’ã€‚

**å¯åŠ¨ UI:**
```bash
./bin/cat-cafe --mode ui
```

**å‘é€ä»»åŠ¡:**
```bash
> @Agentåç§° ä»»åŠ¡å†…å®¹
```

**å¯ç”¨å‘½ä»¤:**
- `/list` - åˆ—å‡ºæ‰€æœ‰ Agent
- `/help` - æ˜¾ç¤ºå¸®åŠ©
- `/exit` - é€€å‡ºç¨‹åº

### æ–¹å¼äºŒï¼šå‘½ä»¤è¡Œæ¨¡å¼

é€‚åˆè„šæœ¬åŒ–å’Œè‡ªåŠ¨åŒ–åœºæ™¯ã€‚

**åˆ—å‡º Agent:**
```bash
./bin/cat-cafe --list
```

**å‘é€ä»»åŠ¡:**
```bash
./bin/cat-cafe --send --to èŠ±èŠ± --task "å®ç°HTTPæœåŠ¡å™¨"
```

### æ–¹å¼ä¸‰ï¼šAPI æ¨¡å¼ï¼ˆæ¨èç”¨äºå‰ç«¯é›†æˆï¼‰

æä¾› RESTful API æ¥å£ï¼Œæ”¯æŒ Web å‰ç«¯å’Œå…¶ä»–å®¢æˆ·ç«¯æ¥å…¥ã€‚

**å¯åŠ¨ API æœåŠ¡å™¨:**
```bash
./bin/cat-cafe --mode api --port 8080
```

æˆ–ä½¿ç”¨ä¾¿æ·è„šæœ¬ï¼ˆä¼šè‡ªåŠ¨å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼‰ï¼š
```bash
./start.sh
```

**API ç‰¹æ€§:**
- âœ… ä¼šè¯ç®¡ç†ï¼šåˆ›å»ºã€æŸ¥è¯¢ã€åˆ é™¤ä¼šè¯
- âœ… æ¶ˆæ¯ç®¡ç†ï¼šå‘é€æ¶ˆæ¯ã€è·å–å†å²æ¶ˆæ¯
- âœ… Agent ç®¡ç†ï¼šæŸ¥è¯¢å¯ç”¨çš„çŒ«çŒ« Agent
- âœ… å®æ—¶å›å¤ï¼šAgent å¤„ç†å®Œæˆåè‡ªåŠ¨å°†å›å¤æ·»åŠ åˆ°ä¼šè¯
- âœ… è°ƒç”¨å†å²ï¼šè¿½è¸ªæ¯ä¸ªä¼šè¯ä¸­è°ƒç”¨äº†å“ªäº› Agent

**åŸºæœ¬ä½¿ç”¨æµç¨‹:**

1. **åˆ›å»ºä¼šè¯**
```bash
curl -X POST http://localhost:8080/api/sessions
```

2. **å‘é€æ¶ˆæ¯å¹¶æåŠçŒ«çŒ«**
```bash
curl -X POST http://localhost:8080/api/sessions/sess_xxx/messages \
  -H "Content-Type: application/json" \
  -d '{
    "content": "@èŠ±èŠ± ä½ å¥½ï¼Œè¯·å¸®æˆ‘è®¾è®¡ä¸€ä¸ªç³»ç»Ÿ",
    "mentionedCats": ["cat_001"]
  }'
```

3. **è·å–æ¶ˆæ¯åˆ—è¡¨ï¼ˆåŒ…å« Agent å›å¤ï¼‰**
```bash
curl http://localhost:8080/api/sessions/sess_xxx/messages
```

**æ¶ˆæ¯ç±»å‹:**
- `user`: ç”¨æˆ·å‘é€çš„æ¶ˆæ¯
- `agent`: Agentï¼ˆçŒ«çŒ«ï¼‰çš„å›å¤
- `system`: ç³»ç»Ÿæ¶ˆæ¯ï¼ˆå¦‚"èŠ±èŠ±å·²åŠ å…¥å¯¹è¯"ï¼‰

**è¯¦ç»† API æ–‡æ¡£:** å‚è§ `frontend/docs/API.md`

---

## ğŸ”„ Agent åä½œæœºåˆ¶

### Agent å¦‚ä½•ç›¸äº’è°ƒç”¨

Agent åœ¨å®Œæˆä»»åŠ¡åï¼Œå¯ä»¥åœ¨è¾“å‡ºä¸­ä½¿ç”¨ **@æ ‡è®°** æ¥è°ƒç”¨å…¶ä»– Agentï¼Œå®ç°è‡ªåŠ¨åŒ–å·¥ä½œæµã€‚

### @æ ‡è®°è¯­æ³•

```
@Agentåç§° ä»»åŠ¡å†…å®¹
```

**è§„åˆ™:**
- @æ ‡è®°å¿…é¡»åœ¨è¡Œé¦–
- æ¯è¡Œä¸€ä¸ª @æ ‡è®°
- æ ¼å¼: `@çŒ«çŒ«å ä»»åŠ¡å†…å®¹`

### ç‰¹æ®Šæ ‡è®°

**@é“²å±å®˜** - è¿”å›ç»™ç”¨æˆ·ï¼Œè¡¨ç¤ºæ‰€æœ‰å·¥ä½œå®Œæˆ:
```
@é“²å±å®˜ ä»»åŠ¡å®Œæˆï¼Œè¯·æŸ¥çœ‹ç»“æœ
```

### åä½œç¤ºä¾‹

#### ç¤ºä¾‹ 1: èŠ±èŠ±è°ƒç”¨è–‡è–‡å®¡æŸ¥

èŠ±èŠ±è¾“å‡º:
```
ã€ç³»ç»Ÿè®¾è®¡ã€‘
ç”¨æˆ·è®¤è¯ç³»ç»Ÿæ¶æ„è®¾è®¡å®Œæˆ...

@è–‡è–‡ è¯·å®¡æŸ¥è¿™ä¸ªç³»ç»Ÿçš„å®‰å…¨æ€§
[æ¶æ„æ–‡æ¡£å†…å®¹]
```

è–‡è–‡ä¼šè‡ªåŠ¨æ”¶åˆ°ä»»åŠ¡å¹¶å¼€å§‹å®¡æŸ¥ã€‚

#### ç¤ºä¾‹ 2: è–‡è–‡å‘ç°é—®é¢˜ï¼Œè¦æ±‚èŠ±èŠ±ä¿®å¤

è–‡è–‡è¾“å‡º:
```
ã€å®¡æŸ¥æŠ¥å‘Šã€‘
å‘ç°3ä¸ªå®‰å…¨é—®é¢˜:
1. å¯†ç æœªåŠ å¯†
2. ç¼ºå°‘ CSRF é˜²æŠ¤
3. Session ç®¡ç†ä¸å½“

@èŠ±èŠ± è¯·ä¿®å¤è¿™äº›å®‰å…¨é—®é¢˜
[è¯¦ç»†é—®é¢˜è¯´æ˜]
```

èŠ±èŠ±ä¼šè‡ªåŠ¨æ”¶åˆ°ä»»åŠ¡å¹¶ä¿®å¤é—®é¢˜ã€‚

#### ç¤ºä¾‹ 3: å®Œæ•´å·¥ä½œæµ

```
ç”¨æˆ·: @èŠ±èŠ± å¼€å‘ç”¨æˆ·ç™»å½•ç³»ç»Ÿ

èŠ±èŠ± â†’ è®¾è®¡æ¶æ„
    â†“
    @è–‡è–‡ å®¡æŸ¥å®‰å…¨æ€§

è–‡è–‡ â†’ å‘ç°é—®é¢˜
    â†“
    @èŠ±èŠ± ä¿®å¤é—®é¢˜

èŠ±èŠ± â†’ ä¿®å¤å®Œæˆ
    â†“
    @å°ä¹” è®¾è®¡ç•Œé¢

å°ä¹” â†’ è®¾è®¡å®Œæˆ
    â†“
    @é“²å±å®˜ é¡¹ç›®å®Œæˆ
```

### Agent æç¤ºè¯é…ç½®

æ¯ä¸ª Agent çš„ç³»ç»Ÿæç¤ºè¯ä¸­éƒ½åŒ…å«äº†åä½œæœºåˆ¶è¯´æ˜ï¼Œå‘Šè¯‰å®ƒä»¬å¦‚ä½•ä½¿ç”¨ @æ ‡è®°ã€‚

æŸ¥çœ‹æç¤ºè¯æ–‡ä»¶:
- `prompts/calico_cat.md` - èŠ±èŠ±
- `prompts/lihua_cat.md` - è–‡è–‡
- `prompts/silver_cat.md` - å°ä¹”

---

## âš™ï¸ é…ç½®

ç¼–è¾‘ `config.yaml`:

```yaml
agents:
  - name: "èŠ±èŠ±"
    pipe: "pipe_huahua"
    exec_cmd: "./minimal-claude"
    system_prompt_path: "prompts/calico_cat.md"

  - name: "è–‡è–‡"
    pipe: "pipe_weiwei"
    exec_cmd: "./minimal-codex"
    system_prompt_path: "prompts/lihua_cat.md"

  - name: "å°ä¹”"
    pipe: "pipe_xiaoqiao"
    exec_cmd: "./minimal-gemini"
    system_prompt_path: "prompts/silver_cat.md"

redis:
  addr: "localhost:6379"
  password: ""
  db: 0
```

---

## ğŸ“– ä½¿ç”¨æ–¹æ³•

### åˆ—å‡ºæ‰€æœ‰ Agent

```bash
./bin/cat-cafe --list
```

è¾“å‡º:
```
ğŸ± å¯ç”¨çš„ Agent:

  èŠ±èŠ± (claude)
    ç®¡é“: pipe_huahua
    æ‰§è¡Œå‘½ä»¤: ./bin/minimal-claude
    ç³»ç»Ÿæç¤ºè¯: prompts/calico_cat.md
    çŠ¶æ€: idle

  è–‡è–‡ (codex)
    ç®¡é“: pipe_weiwei
    æ‰§è¡Œå‘½ä»¤: ./bin/minimal-codex
    ç³»ç»Ÿæç¤ºè¯: prompts/lihua_cat.md
    çŠ¶æ€: idle

  å°ä¹” (gemini)
    ç®¡é“: pipe_xiaoqiao
    æ‰§è¡Œå‘½ä»¤: ./bin/minimal-gemini
    ç³»ç»Ÿæç¤ºè¯: prompts/silver_cat.md
    çŠ¶æ€: idle
```

### å‘é€ä»»åŠ¡

```bash
# å‘é€ä»»åŠ¡ç»™èŠ±èŠ±
./bin/cat-cafe --send --to èŠ±èŠ± --task "å®ç°ä¸€ä¸ª HTTP æœåŠ¡å™¨"

# å‘é€ä»»åŠ¡ç»™è–‡è–‡
./bin/cat-cafe --send --to è–‡è–‡ --task "å®¡æŸ¥ server.go çš„å®‰å…¨æ€§"

# å‘é€ä»»åŠ¡ç»™å°ä¹”
./bin/cat-cafe --send --to å°ä¹” --task "è®¾è®¡ç™»å½•é¡µé¢"
```

### å¯åŠ¨ Agent Worker

åœ¨ä¸åŒçš„ç»ˆç«¯çª—å£ä¸­å¯åŠ¨å„ä¸ª Agent:

```bash
# ç»ˆç«¯ 1: å¯åŠ¨èŠ±èŠ±
./bin/cat-cafe --mode agent --agent èŠ±èŠ±

# ç»ˆç«¯ 2: å¯åŠ¨è–‡è–‡
./bin/cat-cafe --mode agent --agent è–‡è–‡

# ç»ˆç«¯ 3: å¯åŠ¨å°ä¹”
./bin/cat-cafe --mode agent --agent å°ä¹”
```

---

## ğŸ”„ å·¥ä½œæµç¨‹

### å®Œæ•´æµç¨‹ç¤ºä¾‹

1. **å¯åŠ¨æ‰€æœ‰ Agent**

```bash
# ç»ˆç«¯ 1
./bin/cat-cafe --mode agent --agent èŠ±èŠ±

# ç»ˆç«¯ 2
./bin/cat-cafe --mode agent --agent è–‡è–‡

# ç»ˆç«¯ 3
./bin/cat-cafe --mode agent --agent å°ä¹”
```

2. **å‘é€ä»»åŠ¡ç»™èŠ±èŠ±è¿›è¡Œæ¶æ„è®¾è®¡**

```bash
./bin/cat-cafe --send --to èŠ±èŠ± --task "è®¾è®¡ä¸€ä¸ªç”¨æˆ·è®¤è¯ç³»ç»Ÿ"
```

èŠ±èŠ±ä¼š:
- åˆ†æéœ€æ±‚
- è®¾è®¡ç³»ç»Ÿæ¶æ„
- å®ç°æ ¸å¿ƒä»£ç 
- è¾“å‡ºè®¾è®¡æ–‡æ¡£

3. **å‘é€ä»»åŠ¡ç»™è–‡è–‡è¿›è¡Œä»£ç å®¡æŸ¥**

```bash
./bin/cat-cafe --send --to è–‡è–‡ --task "å®¡æŸ¥èŠ±èŠ±è®¾è®¡çš„ç”¨æˆ·è®¤è¯ç³»ç»Ÿ"
```

è–‡è–‡ä¼š:
- æ£€æŸ¥ä»£ç è´¨é‡
- å‘ç°å®‰å…¨æ¼æ´
- æå‡ºæ”¹è¿›å»ºè®®
- è®¾è®¡æµ‹è¯•æ–¹æ¡ˆ

4. **å‘é€ä»»åŠ¡ç»™å°ä¹”è¿›è¡Œ UI è®¾è®¡**

```bash
./bin/cat-cafe --send --to å°ä¹” --task "è®¾è®¡ç”¨æˆ·è®¤è¯ç³»ç»Ÿçš„ç™»å½•ç•Œé¢"
```

å°ä¹”ä¼š:
- è®¾è®¡ UI ç•Œé¢
- è§„åˆ’äº¤äº’æµç¨‹
- æä¾›è§†è§‰æ–¹æ¡ˆ
- ç»™å‡ºå®ç°å»ºè®®

---

## ğŸ§ª è¿è¡Œæµ‹è¯•

```bash
# å¯åŠ¨ Redis
redis-server --daemonize yes

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
cd test && go test -v -count=1

# æŸ¥çœ‹æµ‹è¯•æŠ¥å‘Š
cat ../TEST_REPORT.md
```

---

## ğŸ›  é«˜çº§ç”¨æ³•

### è‡ªå®šä¹‰é…ç½®æ–‡ä»¶

```bash
./cat-cafe --config custom_config.yaml --list
```

### æ·»åŠ æ–° Agent

1. åˆ›å»ºç³»ç»Ÿæç¤ºè¯æ–‡ä»¶ `prompts/new_agent.md`
2. åœ¨ `config.yaml` ä¸­æ·»åŠ é…ç½®:

```yaml
agents:
  - name: "æ–°çŒ«å’ª"
    pipe: "pipe_new"
    exec_cmd: "./new-agent-cli"
    system_prompt_path: "prompts/new_agent.md"
```

3. é‡å¯è°ƒåº¦å™¨å³å¯

### ç›‘æ§ Redis é˜Ÿåˆ—

```bash
# æŸ¥çœ‹æ‰€æœ‰ Stream
redis-cli KEYS "pipe:*"

# æŸ¥çœ‹ç‰¹å®šç®¡é“çš„æ¶ˆæ¯
redis-cli XREAD COUNT 10 STREAMS pipe:pipe_huahua 0

# æŸ¥çœ‹æ¶ˆè´¹è€…ç»„ä¿¡æ¯
redis-cli XINFO GROUPS pipe:pipe_huahua
```

---

## ğŸ› æ•…éšœæ’æŸ¥

### Redis è¿æ¥å¤±è´¥

```bash
# æ£€æŸ¥ Redis æ˜¯å¦è¿è¡Œ
redis-cli ping

# å¦‚æœæ²¡æœ‰è¿è¡Œï¼Œå¯åŠ¨ Redis
redis-server --daemonize yes
```

### Agent æ— æ³•å¯åŠ¨

```bash
# æ£€æŸ¥é…ç½®æ–‡ä»¶
cat config.yaml

# æ£€æŸ¥ç³»ç»Ÿæç¤ºè¯æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -la prompts/

# æ£€æŸ¥æ‰§è¡Œå‘½ä»¤æ˜¯å¦å­˜åœ¨
ls -la minimal-*
```

### ä»»åŠ¡å‘é€å¤±è´¥

```bash
# æ£€æŸ¥ Agent åç§°æ˜¯å¦æ­£ç¡®
./cat-cafe --list

# æ£€æŸ¥ Redis è¿æ¥
redis-cli ping

# æŸ¥çœ‹ Redis æ—¥å¿—
tail -f /usr/local/var/log/redis.log
```

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### è°ƒæ•´ Redis é…ç½®

ç¼–è¾‘ `/usr/local/etc/redis.conf`:

```conf
# å¢åŠ æœ€å¤§å†…å­˜
maxmemory 2gb

# è®¾ç½®æ·˜æ±°ç­–ç•¥
maxmemory-policy allkeys-lru

# å¯ç”¨æŒä¹…åŒ–
save 900 1
save 300 10
save 60 10000
```

### å¹¶å‘å¤„ç†

å¯åŠ¨å¤šä¸ªç›¸åŒ Agent çš„ Worker:

```bash
# å¯åŠ¨ 3 ä¸ªèŠ±èŠ± Worker
./cat-cafe --mode agent --agent èŠ±èŠ± &
./cat-cafe --mode agent --agent èŠ±èŠ± &
./cat-cafe --mode agent --agent èŠ±èŠ± &
```

---

## ğŸ” å®‰å…¨å»ºè®®

1. **é…ç½®æ–‡ä»¶æƒé™**
   ```bash
   chmod 600 config.yaml
   ```

2. **Redis å¯†ç ä¿æŠ¤**
   ```yaml
   redis:
     addr: "localhost:6379"
     password: "your-strong-password"
     db: 0
   ```

3. **ç³»ç»Ÿæç¤ºè¯ä¿æŠ¤**
   ```bash
   chmod 600 prompts/*.md
   ```

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

- [SPEC.md](SPEC.md) - ç³»ç»Ÿè®¾è®¡è§„èŒƒ
- [TEST_SPEC.md](TEST_SPEC.md) - æµ‹è¯•è§„èŒƒ
- [TEST_REPORT.md](TEST_REPORT.md) - æµ‹è¯•æŠ¥å‘Š
- [README.md](README.md) - é¡¹ç›®è¯´æ˜

---

## ğŸ’¡ æœ€ä½³å®è·µ

1. **ä»»åŠ¡æè¿°è¦æ¸…æ™°**: æä¾›è¯¦ç»†çš„éœ€æ±‚æè¿°
2. **åˆç†åˆ†é…ä»»åŠ¡**: æ ¹æ® Agent èŒè´£åˆ†é…ä»»åŠ¡
3. **ç›‘æ§é˜Ÿåˆ—çŠ¶æ€**: å®šæœŸæ£€æŸ¥ Redis é˜Ÿåˆ—
4. **æ—¥å¿—è®°å½•**: ä¿å­˜ Agent è¾“å‡ºæ—¥å¿—
5. **å®šæœŸæ¸…ç†**: æ¸…ç†å·²å®Œæˆçš„ä»»åŠ¡æ¶ˆæ¯

---

## ğŸ‰ ç¤ºä¾‹åœºæ™¯

### åœºæ™¯ 1: å¼€å‘æ–°åŠŸèƒ½

```bash
# 1. èŠ±èŠ±è®¾è®¡æ¶æ„
./cat-cafe --send --to èŠ±èŠ± --task "è®¾è®¡åšå®¢ç³»ç»Ÿçš„æ–‡ç« ç®¡ç†æ¨¡å—"

# 2. è–‡è–‡å®¡æŸ¥ä»£ç 
./cat-cafe --send --to è–‡è–‡ --task "å®¡æŸ¥æ–‡ç« ç®¡ç†æ¨¡å—çš„ä»£ç "

# 3. å°ä¹”è®¾è®¡ç•Œé¢
./cat-cafe --send --to å°ä¹” --task "è®¾è®¡æ–‡ç« ç¼–è¾‘å™¨ç•Œé¢"
```

### åœºæ™¯ 2: Bug ä¿®å¤

```bash
# 1. è–‡è–‡åˆ†æé—®é¢˜
./cat-cafe --send --to è–‡è–‡ --task "åˆ†æç™»å½•å¤±è´¥çš„ bug"

# 2. èŠ±èŠ±ä¿®å¤ä»£ç 
./cat-cafe --send --to èŠ±èŠ± --task "ä¿®å¤ç™»å½•éªŒè¯é€»è¾‘"

# 3. è–‡è–‡éªŒè¯ä¿®å¤
./cat-cafe --send --to è–‡è–‡ --task "éªŒè¯ç™»å½• bug æ˜¯å¦ä¿®å¤"
```

### åœºæ™¯ 3: ä»£ç é‡æ„

```bash
# 1. èŠ±èŠ±é‡æ„ä»£ç 
./cat-cafe --send --to èŠ±èŠ± --task "é‡æ„ç”¨æˆ·æ¨¡å—ï¼Œæé«˜å¯ç»´æŠ¤æ€§"

# 2. è–‡è–‡å®¡æŸ¥é‡æ„
./cat-cafe --send --to è–‡è–‡ --task "å®¡æŸ¥é‡æ„åçš„ä»£ç è´¨é‡"

# 3. å°ä¹”æ›´æ–°æ–‡æ¡£
./cat-cafe --send --to å°ä¹” --task "æ›´æ–°ç”¨æˆ·æ¨¡å—çš„ UI æ–‡æ¡£"
```
